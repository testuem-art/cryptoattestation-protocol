<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoAttestation Protocol</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js" type="application/javascript"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; }
        .tab { overflow: hidden; border: 1px solid #ccc; background-color: #f1f1f1; }
        .tab button { background-color: inherit; float: left; border: none; outline: none; cursor: pointer; padding: 14px 16px; transition: 0.3s; }
        .tab button:hover { background-color: #ddd; }
        .tab button.active { background-color: #ccc; }
        .tabcontent { display: none; padding: 20px; border: 1px solid #ccc; border-top: none; animation: fadeEffect 1s; }
        @keyframes fadeEffect { from {opacity: 0;} to {opacity: 1;} }
        input, button, textarea { padding: 12px; margin: 10px; width: 90%; font-size: 16px; }
        #result, #addResult { margin-top: 20px; padding: 15px; border-radius: 5px; display: none; }
        .verified { background-color: #d4edda; color: #155724; }
        .not-verified { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>üîç CryptoAttestation Protocol</h1>

    <div class="tab">
        <button class="tablinks active" onclick="openTab(event, 'CheckTab')">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
        <button class="tablinks" onclick="openTab(event, 'AddTab')">–î–æ–±–∞–≤–∏—Ç—å –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏—é</button>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ -->
    <div id="CheckTab" class="tabcontent" style="display:block;">
        <h3>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞</h3>
        <input type="text" id="contractAddress" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —Ç–æ–∫–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0x1234...)">
        <br>
        <button onclick="checkAttestations()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <div id="result"></div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ -->
    <div id="AddTab" class="tabcontent">
    <h3>–î–æ–±–∞–≤–∏—Ç—å –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏—é (—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤)</h3>
    <input type="text" id="assetAddressInput" placeholder="–ê–¥—Ä–µ—Å —Ç–æ–∫–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0x1234...)">
    <br>
    <input type="text" id="assetChainInput" placeholder="ID –±–ª–æ–∫—á–µ–π–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1 –¥–ª—è Ethereum)">
    <br>
    <select id="verificationTypeInput">
        <option value="AUDIT:PASSED">–ê—É–¥–∏—Ç –ø—Ä–æ–π–¥–µ–Ω</option>
        <option value="KYC:VERIFIED">KYC –ø—Ä–æ–π–¥–µ–Ω</option>
        <option value="SAFE:CONFIRMED">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞</option>
        <option value="CUSTOM">–î—Ä—É–≥–æ–µ...</option>
    </select>
    <input type="text" id="customVerificationInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π —Ç–∏–ø –ø—Ä–æ–≤–µ—Ä–∫–∏" style="display:none;">
    <br>
    <button onclick="addAttestation()">–î–æ–±–∞–≤–∏—Ç—å –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏—é</button>
    <div id="addResult"></div>
</div>

<script>
// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Ç–∏–ø–∞
document.getElementById('verificationTypeInput').addEventListener('change', function() {
    const customInput = document.getElementById('customVerificationInput');
    customInput.style.display = this.value === 'CUSTOM' ? 'block' : 'none';
});

// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏
async function addAttestation() {
    const addResultDiv = document.getElementById('addResult');
    addResultDiv.style.display = 'block';
    addResultDiv.className = '';
    addResultDiv.innerText = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é...';

    const provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    const signer = provider.getSigner();
    const contract = new ethers.Contract(contractAddress, abi, signer);

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ö–µ—à–∏ –∏–∑ —á–∏—Ç–∞–µ–º—ã—Ö —Å—Ç—Ä–æ–∫
    const assetAddress = document.getElementById('assetAddressInput').value;
    const chainId = document.getElementById('assetChainInput').value;
    const assetHash = ethers.utils.id(`${chainId}:${assetAddress}`.toLowerCase());

    let verificationType = document.getElementById('verificationTypeInput').value;
    if (verificationType === 'CUSTOM') {
        verificationType = document.getElementById('customVerificationInput').value;
    }
    const dataHash = ethers.utils.id(verificationType);

    try {
        const tx = await contract.addAttestation(assetHash, dataHash);
        addResultDiv.innerText = `‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –•–µ—à: ${tx.hash}. –û–∂–∏–¥–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è...`;
        addResultDiv.className = 'info';

        await tx.wait();
        addResultDiv.innerText = `‚úÖ –ê—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–ª–æ–∫—á–µ–π–Ω!`;
        addResultDiv.className = 'verified';

    } catch (error) {
        addResultDiv.innerText = '‚ùå –û—à–∏–±–∫–∞: ' + error.message;
        addResultDiv.className = 'not-verified';
    }
}
</script>
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø - –ó–ê–ú–ï–ù–ò –ù–ê –°–í–û–ò –î–ê–ù–ù–´–ï!
        const contractAddress = "0xac9cd46cd8be86413eb0d022ee9b4eed680a21ec1b572c7ec18b112f563215aa"; // –ê–¥—Ä–µ—Å –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
        const abi = [ 
			{
				"inputs": [],
				"name": "retrieve",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "num",
						"type": "uint256"
					}
				],
				"name": "store",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			}
		];
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏–∑ GitHub Issues
async function fetchVerifiers() {
    const repoOwner = '–¢–í–û–ô_–õ–û–ì–ò–ù'; // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –ª–æ–≥–∏–Ω GitHub
    const repoName = 'cryptoattestation-protocol'; // –ó–∞–º–µ–Ω–∏ –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    const issueNumber = 1; // –ù–æ–º–µ—Ä issue, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–æ–∑–¥–∞–ª–∏

    try {
        const response = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/issues/${issueNumber}/comments`);
        const comments = await response.json();
        
        // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —Å–ø–∏—Å–æ–∫ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –≤ –ø–µ—Ä–≤–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
        if (comments.length > 0) {
            const commentText = comments[0].body;
            // –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞ "–ê–¥—Ä–µ—Å: 0x... | –ò–º—è: ... | –°–∞–π—Ç: ..."
            const verifierLines = commentText.split('\n').filter(line => line.includes('–ê–¥—Ä–µ—Å:'));
            
            const verifiers = {};
            verifierLines.forEach(line => {
                const addressMatch = line.match(/–ê–¥—Ä–µ—Å:\s*(0x[a-fA-F0-9]{40})/);
                const nameMatch = line.match(/–ò–º—è:\s*([^|]+)/);
                const websiteMatch = line.match(/–°–∞–π—Ç:\s*([^|]+)/);
                
                if (addressMatch && nameMatch) {
                    verifiers[addressMatch[1].toLowerCase()] = {
                        name: nameMatch[1].trim(),
                        website: websiteMatch ? websiteMatch[1].trim() : ''
                    };
                }
            });
            
            return verifiers;
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤:', error);
    }
    
    return {};
}

// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–π
async function checkAttestations() {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    try {
        const count = await contract.getAttestationCount(assetHash);
        const verifiersList = await fetchVerifiers(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
        
        if (count > 0) {
            let resultText = `‚úÖ –£ —ç—Ç–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –µ—Å—Ç—å ${count} –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–π!\n\n`;
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–π –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏
            for (let i = 0; i < count; i++) {
                const attestation = await contract.getAttestation(assetHash, i);
                const verifierAddress = attestation.verifier.toLowerCase();
                const verifierInfo = verifiersList[verifierAddress] || {name: verifierAddress};
                
                resultText += `–ê—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è ${i+1}: ${verifierInfo.name}\n`;
                if (verifierInfo.website) {
                    resultText += `–°–∞–π—Ç: ${verifierInfo.website}\n`;
                }
                resultText += `–î–∞–Ω–Ω—ã–µ: ${attestation.dataHash}\n`;
                resultText += `–í—Ä–µ–º—è: ${new Date(attestation.timestamp * 1000).toLocaleString()}\n\n`;
            }
            
            resultDiv.innerText = resultText;
            resultDiv.className = 'verified';
        } else {
            resultDiv.innerText = '‚ùå –£ —ç—Ç–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–π. –û—Å—Ç–æ—Ä–æ–∂–Ω–æ!';
            resultDiv.className = 'not-verified';
        }
    } catch (error) {
        resultDiv.innerText = '‚ö†Ô∏è –û—à–∏–±–∫–∞: ' + error.message;
        resultDiv.className = 'not-verified';
    }
}
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) { tabcontent[i].style.display = "none"; }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) { tablinks[i].className = tablinks[i].className.replace(" active", ""); }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–π
        async function checkAttestations() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.className = '';
            resultDiv.innerText = '–ü—Ä–æ–≤–µ—Ä—è–µ–º...';

            const provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            const contract = new ethers.Contract(contractAddress, abi, provider);
            const assetHash = ethers.utils.id(document.getElementById('contractAddress').value);

            try {
                const count = await contract.getAttestationCount(assetHash);
                if (count > 0) {
                    resultDiv.innerText = `‚úÖ –£ —ç—Ç–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –µ—Å—Ç—å ${count} –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–π!`;
                    resultDiv.className = 'verified';
                } else {
                    resultDiv.innerText = '‚ùå –£ —ç—Ç–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–π. –û—Å—Ç–æ—Ä–æ–∂–Ω–æ!';
                    resultDiv.className = 'not-verified';
                }
            } catch (error) {
                resultDiv.innerText = '‚ö†Ô∏è –û—à–∏–±–∫–∞: ' + error.message;
                resultDiv.className = 'not-verified';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏
        async function addAttestation() {
            const addResultDiv = document.getElementById('addResult');
            addResultDiv.style.display = 'block';
            addResultDiv.className = '';
            addResultDiv.innerText = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é...';

            const provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            const signer = provider.getSigner(); // –ü–æ–ª—É—á–∞–µ–º signer –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
            const contract = new ethers.Contract(contractAddress, abi, signer); // –ò—Å–ø–æ–ª—å–∑—É–µ–º signer –≤–º–µ—Å—Ç–æ provider

            const assetHash = ethers.utils.id(document.getElementById('assetHashInput').value);
            const dataHash = ethers.utils.id(document.getElementById('dataHashInput').value);

            try {
                const tx = await contract.addAttestation(assetHash, dataHash);
                addResultDiv.innerText = `‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –•–µ—à: ${tx.hash}. –û–∂–∏–¥–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è...`;
                addResultDiv.className = 'info';

                await tx.wait(); // –ñ–¥–µ–º, –ø–æ–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –±—É–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
                addResultDiv.innerText = `‚úÖ –ê—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–ª–æ–∫—á–µ–π–Ω!`;
                addResultDiv.className = 'verified';

            } catch (error) {
                addResultDiv.innerText = '‚ùå –û—à–∏–±–∫–∞: ' + error.message;
                addResultDiv.className = 'not-verified';
            }
        }
    </script>
</body>
</html>
